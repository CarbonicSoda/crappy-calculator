(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))f(c);new MutationObserver(c=>{for(const m of c)if(m.type==="childList")for(const y of m.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&f(y)}).observe(document,{childList:!0,subtree:!0});function h(c){const m={};return c.integrity&&(m.integrity=c.integrity),c.referrerPolicy&&(m.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?m.credentials="include":c.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function f(c){if(c.ep)return;c.ep=!0;const m=h(c);fetch(c.href,m)}})();var n;(t=>{(r=>{r[r.Prefix=0]="Prefix",r[r.Postfix=1]="Postfix",r[r.Function=2]="Function"})(t.UnaryOpTypes||(t.UnaryOpTypes={})),(r=>{r[r.Bracket=0]="Bracket",r[r.Numeral=1]="Numeral",r[r.UnaryOp=2]="UnaryOp",r[r.BinaryOp=3]="BinaryOp"})(t.TokenTypes||(t.TokenTypes={})),(r=>{r[r.Root=0]="Root",r[r.Numeral=1]="Numeral",r[r.UnaryOp=2]="UnaryOp",r[r.BinaryOp=3]="BinaryOp"})(t.TreeTypes||(t.TreeTypes={}))})(n||(n={}));var a;(t=>{t.constantRegistry=new Map,t.constantSymbolRegistry=new Map,t.unaryOpRegistry=new Map,t.unaryOpSymbolRegistry=new Map,t.binaryOpRegistry=new Map,t.binaryOpSymbolRegistry=new Map;function r(o){return t.constantRegistry.has(o)}t.existConstant=r;function h(o){return t.constantSymbolRegistry.has(o)}t.existConstantWithSymbol=h;function f(o){return t.unaryOpRegistry.has(o)}t.existUnaryOp=f;function c(o){return t.unaryOpSymbolRegistry.has(o)}t.existUnaryOpWithSymbol=c;function m(o){return t.binaryOpRegistry.has(o)}t.existBinaryOp=m;function y(o){return t.binaryOpSymbolRegistry.has(o)}t.existBinaryOpWithSymbol=y;function k(o,g){if(r(o))throw new Error(`Constant with id ${o} already exists.`);if(h(g.symbol))throw new Error(`Constant with symbol ${g.symbol} already exists.`);t.constantRegistry.set(o,{id:o,...g}),t.constantSymbolRegistry.set(g.symbol,{id:o,...g})}t.registerConstant=k;function l(o,g){if(f(o))throw new Error(`Unary operator with id ${o} already exists.`);if(c(g.symbol))throw new Error(`Unary operator with symbol ${g.symbol} already exists.`);t.unaryOpRegistry.set(o,{id:o,...g}),t.unaryOpSymbolRegistry.set(g.symbol,{id:o,...g})}t.registerUnaryOp=l;function T(o,g){if(m(o))throw new Error(`Binary operator with id ${o} already exists.`);if(y(g.symbol))throw new Error(`Binary operator with symbol ${g.symbol} already exists.`);t.binaryOpRegistry.set(o,{id:o,...g}),t.binaryOpSymbolRegistry.set(g.symbol,{id:o,...g})}t.registerBinaryOp=T;function w(){return[...t.constantSymbolRegistry.keys()]}t.getConstantSymbols=w;function u(){return[...t.unaryOpSymbolRegistry.keys()]}t.getUnaryOpSymbols=u;function b(){return[...t.binaryOpSymbolRegistry.keys()]}t.getBinaryOpSymbols=b;function O(o){if(!r(o))throw new Error(`Constant with id ${o} is not registered.`);return t.constantRegistry.get(o)}t.getConstant=O;function s(o){if(!h(o))throw new Error(`Constant with symbol ${o} is not registered.`);return t.constantSymbolRegistry.get(o)}t.getConstantWithSymbol=s;function e(o){if(!f(o))throw new Error(`Unary operator with id ${o} is not registered.`);return t.unaryOpRegistry.get(o)}t.getUnaryOp=e;function p(o){if(!c(o))throw new Error(`Unary operator with symbol ${o} is not registered.`);return t.unaryOpSymbolRegistry.get(o)}t.getUnaryOpWithSymbol=p;function i(o){if(!m(o))throw new Error(`Binary operator with id ${o} is not registered.`);return t.binaryOpRegistry.get(o)}t.getBinaryOp=i;function d(o){if(!y(o))throw new Error(`Binary operator with symbol ${o} is not registered.`);return t.binaryOpSymbolRegistry.get(o)}t.getBinaryOpWithSymbol=d})(a||(a={}));var S;(t=>{function h(l){if(l===1/0)return 1/0;if(l>=0&&l<100&&Number.isInteger(l)){let T=1;for(let w=2;w<l+1;w++)T*=w;return T}return c(l+1)}t.factorial=h;function f(l){return h(l-1)}t.gamma=f;function c(l){const w=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];if(l<.5)return Math.PI/(Math.sin(Math.PI*l)*c(1-l));l--;let u=w[0];for(let s=1;s<9;s++)u+=w[s]/(l+s);const b=l+7+.5,O=Math.pow(b,l+.5);return O===1/0?1/0:Math.sqrt(2*Math.PI)*O*Math.exp(-b)*u}function m(l,T){return h(l)/h(l-T)}t.permutation=m;function y(l,T){return m(l,T)/h(T)}t.combination=y;function k(l,T){if(!Number.isInteger(l)||!Number.isInteger(T))return NaN;for(;T!==0;)l>T&&([l,T]=[T,l]),T=T%l;return l}t.gcd=k})(S||(S={}));a.registerConstant("e",{symbol:"E",value:Math.E});a.registerConstant("pi",{symbol:"PI",value:Math.PI});a.registerConstant("inf",{symbol:"INF",value:1/0});a.registerUnaryOp("pos",{symbol:"+",type:n.UnaryOpTypes.Prefix,callback:t=>t});a.registerUnaryOp("neg",{symbol:"-",type:n.UnaryOpTypes.Prefix,callback:t=>-t});a.registerUnaryOp("factorial",{symbol:"!",type:n.UnaryOpTypes.Postfix,callback:S.factorial});a.registerUnaryOp("degree",{symbol:"d",type:n.UnaryOpTypes.Postfix,callback:t=>Math.PI*t/180});a.registerUnaryOp("abs",{symbol:"abs",type:n.UnaryOpTypes.Function,callback:Math.abs});a.registerUnaryOp("floor",{symbol:"floor",type:n.UnaryOpTypes.Function,callback:Math.floor});a.registerUnaryOp("ceil",{symbol:"ceil",type:n.UnaryOpTypes.Function,callback:Math.ceil});a.registerUnaryOp("round",{symbol:"round",type:n.UnaryOpTypes.Function,callback:Math.round});a.registerUnaryOp("sqrt",{symbol:"sqrt",type:n.UnaryOpTypes.Function,callback:Math.sqrt});a.registerUnaryOp("exp",{symbol:"exp",type:n.UnaryOpTypes.Function,callback:Math.exp});a.registerUnaryOp("log",{symbol:"Ln",type:n.UnaryOpTypes.Function,callback:Math.log});a.registerUnaryOp("log10",{symbol:"log",type:n.UnaryOpTypes.Function,callback:Math.log10});a.registerUnaryOp("sin",{symbol:"sin",type:n.UnaryOpTypes.Function,callback:Math.sin});a.registerUnaryOp("cos",{symbol:"cos",type:n.UnaryOpTypes.Function,callback:Math.cos});a.registerUnaryOp("tan",{symbol:"tan",type:n.UnaryOpTypes.Function,callback:Math.tan});a.registerUnaryOp("asin",{symbol:"asin",type:n.UnaryOpTypes.Function,callback:Math.asin});a.registerUnaryOp("acos",{symbol:"acos",type:n.UnaryOpTypes.Function,callback:Math.acos});a.registerUnaryOp("atan",{symbol:"atan",type:n.UnaryOpTypes.Function,callback:Math.atan});a.registerUnaryOp("gamma",{symbol:"Gamma",type:n.UnaryOpTypes.Function,callback:S.gamma});a.registerBinaryOp("add",{symbol:"+",callback:(t,r)=>t+r,precedence:0});a.registerBinaryOp("sub",{symbol:"-",callback:(t,r)=>t-r,precedence:0});a.registerBinaryOp("mul",{symbol:"*",callback:(t,r)=>t*r,precedence:1});a.registerBinaryOp("div",{symbol:"/",callback:(t,r)=>t/r,precedence:1});a.registerBinaryOp("int_div",{symbol:"//",callback:(t,r)=>Math.floor(t/r),precedence:1});a.registerBinaryOp("pow",{symbol:"**",callback:(t,r)=>t**r,precedence:2});a.registerBinaryOp("pow_alias",{symbol:"^",callback:(t,r)=>t**r,precedence:2});a.registerBinaryOp("mod",{symbol:"%",callback:(t,r)=>t%r,precedence:2});const E=100;a.registerBinaryOp("min",{symbol:"min",callback:Math.min,precedence:E});a.registerBinaryOp("max",{symbol:"max",callback:Math.max,precedence:E});a.registerBinaryOp("permutation",{symbol:"P",callback:S.permutation,precedence:E});a.registerBinaryOp("combination",{symbol:"C",callback:S.combination,precedence:E});a.registerBinaryOp("gcd",{symbol:"gcd",callback:S.gcd,precedence:E});var N;(t=>{function r(u){const b=u.length,O=[];for(;u.length;){const s=b-u.length,e=y(u,s,O);u=u.slice(e.length)}return O}t.tokenize=r;class h{constructor(b,O,s){this.type=b,this.symbol=O,this.meta=s}get position(){return this.meta.from===this.meta.to?`${this.meta.from}`:`${this.meta.from}-${this.meta.to}`}toString(){return`[${this.position}] ${this.symbol}`}toJSON(){return{symbol:this.symbol,meta:this.meta}}}t.Token=h;const f=u=>u.replaceAll(/[.*+?^${}()|[\]\\]/g,"\\$&"),c=Object.keys(n.TokenTypes).length/2,m={[n.TokenTypes.Bracket]:/[()]/,[n.TokenTypes.Numeral]:new RegExp(`(?:${a.getConstantSymbols().sort((u,b)=>b.length-u.length).map(f).join(")|(?:")})|(?:\\d+(?:\\.\\d+)?(?:[eE][+-]?\\d+)?)`),[n.TokenTypes.UnaryOp]:new RegExp(`(?:${a.getUnaryOpSymbols().sort((u,b)=>b.length-u.length).map(f).join(")|(?:")})`),[n.TokenTypes.BinaryOp]:new RegExp(`(?:${a.getBinaryOpSymbols().sort((u,b)=>b.length-u.length).map(f).join(")|(?:")})`)};function y(u,b,O){let s;for(let e=0;e<c;e++){const p=new RegExp(`^\\s*(?:${m[e].source})\\s*`);if(s=u.match(p)?.[0],s===void 0)continue;let i=s.trimStart();const d=b+s.length-i.length;i=i.trimEnd();const o=d+i.length-1,g={from:d,to:o},x=O.at(-1);switch(e){case n.TokenTypes.Bracket:{if(k(O,i,g,x))break;continue}case n.TokenTypes.Numeral:{if(l(O,i,g,x))break;continue}case n.TokenTypes.UnaryOp:{if(T(O,i,g,x))break;continue}case n.TokenTypes.BinaryOp:{if(w(O,i,g))break;continue}}break}if(!s)throw new SyntaxError(`Invalid symbol at ${b}.`);return s}function k(u,b,O,s){const e=s?.symbol===")"||s?.type===n.TokenTypes.Numeral||s?.type===n.TokenTypes.UnaryOp&&a.getUnaryOpWithSymbol(s.symbol).type===n.UnaryOpTypes.Postfix;if(b==="("&&e&&a.existBinaryOp("mul")){const i=new h(n.TokenTypes.BinaryOp,a.getBinaryOp("mul").symbol,O);u.push(i)}const p=new h(n.TokenTypes.Bracket,b,O);return u.push(p)}function l(u,b,O,s){if(s?.symbol===")"||s?.type===n.TokenTypes.Numeral||s?.type===n.TokenTypes.UnaryOp&&a.getUnaryOpWithSymbol(s.symbol).type===n.UnaryOpTypes.Postfix)if(a.existConstantWithSymbol(b)&&a.existBinaryOp("mul")){const i=new h(n.TokenTypes.BinaryOp,a.getBinaryOp("mul").symbol,O);u.push(i)}else return!1;const p=new h(n.TokenTypes.Numeral,b,O);return u.push(p)}function T(u,b,O,s){const e=s?.symbol===")"||s?.type===n.TokenTypes.Numeral||s?.type===n.TokenTypes.UnaryOp&&a.getUnaryOpWithSymbol(s.symbol).type===n.UnaryOpTypes.Postfix;switch(a.getUnaryOpWithSymbol(b).type){case n.UnaryOpTypes.Prefix:{if(e)return!1;break}case n.UnaryOpTypes.Postfix:{if(!e)return!1;break}case n.UnaryOpTypes.Function:{if(!e||!a.existBinaryOp("mul"))break;const i=new h(n.TokenTypes.BinaryOp,a.getBinaryOp("mul").symbol,O);u.push(i);break}}const p=new h(n.TokenTypes.UnaryOp,b,O);return u.push(p)}function w(u,b,O,s){const e=new h(n.TokenTypes.BinaryOp,b,O);return u.push(e)}})(N||(N={}));var $;(t=>{function r(s){const e=new y,p={index:0,position:()=>p.tokens[p.index].position,tokens:s,pointer:e};for(;p.index<s.length;){const i=s[p.index];switch(i.type){case n.TokenTypes.Bracket:{w(i,p);break}case n.TokenTypes.Numeral:{u(i,p);break}case n.TokenTypes.UnaryOp:{b(i,p);break}case n.TokenTypes.BinaryOp:{O(i,p);break}}p.index++}return e}t.parse=r;class h{constructor(e,p){this.type=e,this.precedence=p}clone(){const e=Object.create(Object.getPrototypeOf(this));return Object.defineProperties(e,Object.getOwnPropertyDescriptors(this)),e}}t.Tree=h;const f=-1,c=Number.MAX_SAFE_INTEGER+1,m=Number.MAX_SAFE_INTEGER;class y extends h{$content;set content(e){this.$content=e,e.parent=this}get content(){return this.$content}constructor(){super(n.TreeTypes.Root,f)}toString(){return this.content?this.content.toString():"<Empty>"}toJSON(){return this.content?.toJSON()??{}}}t.RootTree=y;class k extends h{constructor(e,p){super(n.TreeTypes.Numeral,c),this.parent=e,this.numToken=p}toString(){return`<Num> ${this.numToken}`}toJSON(){return{numeral:this.numToken.toJSON()}}}t.NumeralTree=k;class l extends h{constructor(e,p){super(n.TreeTypes.UnaryOp,m),this.parent=e,this.opToken=p,this.operator=a.getUnaryOpWithSymbol(p.symbol)}$argument;set argument(e){this.$argument=e,e.parent=this}get argument(){return this.$argument}operator;toString(e=1){const p=`
`+"  ┃  ".repeat(e);return`<Unary>${p}UOp: ${this.opToken} (${this.operator.id})${p}Arg: ${this.argument?this.argument.toString(e+1):"<Empty>"}`}toJSON(){return{operator:{...this.opToken.toJSON(),...this.operator,type:n.UnaryOpTypes[this.operator.type]},argument:this.argument?.toJSON()??{}}}}t.UnaryOpTree=l;class T extends h{constructor(e,p){const i=a.getBinaryOpWithSymbol(p.symbol);super(n.TreeTypes.BinaryOp,i.precedence),this.parent=e,this.opToken=p,this.operator=i}$left;$right;set left(e){this.$left=e,e.parent=this}get left(){return this.$left}set right(e){this.$right=e,e.parent=this}get right(){return this.$right}operator;toString(e=1){const p=`
`+"  ┃  ".repeat(e);return`<Binary>${p}BOp: ${this.opToken} (${this.operator.id})${p}Lft: ${this.left?this.left.toString(e+1):"<Empty>"}${p}Rgt: ${this.right?this.right.toString(e+1):"<Empty>"}`}toJSON(){return{operator:{...this.opToken.toJSON(),...this.operator},left:this.left?.toJSON()??{},right:this.right?.toJSON()??{}}}}t.BinaryOpTree=T;function w(s,e){if(s.symbol===")")throw new SyntaxError(`Lone right bracket at ${e.position()}.`);if(e.pointer.type===n.TreeTypes.Numeral)throw new SyntaxError(`Missing operator before bracket at ${e.position()}.`);const p=e.index;let i=p,d=1;for(;i<e.tokens.length-1&&(i++,!(e.tokens[i].type===n.TokenTypes.Bracket&&(e.tokens[i].symbol==="("?d++:d--,d===0))););if(d!==0)throw new SyntaxError(`Unbalanced bracket at ${e.position()}.`);if(i===p+1)throw new SyntaxError(`Empty brackets at ${e.position()}.`);e.index=i;const o=r(e.tokens.slice(p+1,i));switch(o.content.precedence=c,e.pointer.type){case n.TreeTypes.Root:{const g=e.pointer;e.pointer=g.content=o.content;break}case n.TreeTypes.UnaryOp:{const g=e.pointer;e.pointer=g.argument=o.content;break}case n.TreeTypes.BinaryOp:{const g=e.pointer;e.pointer=g.right=o.content;break}}}function u(s,e){if(e.pointer.type===n.TreeTypes.Numeral)throw new SyntaxError(`Missing operator between numerals at ${e.position()}.`);const p=new k(e.pointer,s);switch(e.pointer.type){case n.TreeTypes.Root:{const i=e.pointer;e.pointer=i.content=p;break}case n.TreeTypes.UnaryOp:{const i=e.pointer;e.pointer=i.argument=p;break}case n.TreeTypes.BinaryOp:{const i=e.pointer;e.pointer=i.right=p;break}}}function b(s,e){for(;e.pointer.type!==n.TreeTypes.Root&&e.pointer.precedence>m;)e.pointer=e.pointer.parent;const i=a.getUnaryOpWithSymbol(s.symbol).type===n.UnaryOpTypes.Postfix;if(i&&!(e.pointer.type===n.TreeTypes.Root&&e.pointer.content||e.pointer.type===n.TreeTypes.UnaryOp&&e.pointer.argument||e.pointer.type===n.TreeTypes.BinaryOp&&e.pointer.right))throw new SyntaxError(`Missing entry before postfix unary operator at ${e.position()}.`);const d=new l(e.pointer,s);switch(e.pointer.type){case n.TreeTypes.Root:{const o=e.pointer;i&&(d.argument=o.content.clone()),e.pointer=o.content=d;break}case n.TreeTypes.UnaryOp:{const o=e.pointer;i&&(d.argument=o.argument.clone()),e.pointer=o.argument=d;break}case n.TreeTypes.BinaryOp:{const o=e.pointer;i&&(d.argument=o.right.clone()),e.pointer=o.right=d;break}}}function O(s,e){if(e.pointer.type===n.TreeTypes.Root)throw new SyntaxError(`Missing entry before binary operator at ${e.position()}.`);const p=a.getBinaryOpWithSymbol(s.symbol);for(;e.pointer.precedence>=p.precedence;)e.pointer=e.pointer.parent;const i=new T(e.pointer,s);switch(e.pointer.type){case n.TreeTypes.Root:{const d=e.pointer;i.left=d.content.clone(),e.pointer=d.content=i;break}case n.TreeTypes.UnaryOp:{const d=e.pointer;i.left=d.clone(),e.pointer=d.argument=i;break}case n.TreeTypes.BinaryOp:{const d=e.pointer;i.left=d.right.clone(),e.pointer=d.right=i;break}}}})($||($={}));var C;(t=>{function r(y){switch(y.type){case n.TreeTypes.Root:return h(y);case n.TreeTypes.Numeral:return f(y);case n.TreeTypes.UnaryOp:return c(y);case n.TreeTypes.BinaryOp:return m(y)}}t.evaluate=r;function h(y){if(!y.content)throw new SyntaxError("Evaluating empty tree.");return r(y.content)}function f(y){const k=y.numToken.symbol;return a.existConstantWithSymbol(k)?a.getConstantWithSymbol(k).value:Number(k)}function c(y){if(!y.argument)throw new SyntaxError(`Unary operator lacks argument at ${y.opToken.position}.`);const k=a.getUnaryOpWithSymbol(y.operator.symbol).callback;return k(r(y.argument))}function m(y){if(!y.left)throw new SyntaxError(`Binary operator lacks left operand at ${y.opToken.position}.`);if(!y.right)throw new SyntaxError(`Binary operator lacks right operand at ${y.opToken.position}.`);const k=a.getBinaryOpWithSymbol(y.operator.symbol).callback,l=r(y.left),T=r(y.right);return k(l,T)}})(C||(C={}));var M;(t=>{function r(f){const c=N.tokenize(f),m=$.parse(c),y=C.evaluate(m);return{tokens:c,tree:m,value:y}}t.calculate=r;function h(f){return r(f).value}t.value=h})(M||(M={}));const v=50,B=document.getElementById("input"),U=document.getElementById("result");P(B.getAttribute("placeholder"));B.oninput=()=>P(B.value);function P(t){console.clear(),U.classList.remove("error");let r,h;try{const f=performance.now();r=M.calculate(t.length===0?B.getAttribute("placeholder"):t),h=performance.now()-f}catch(f){U.innerHTML="",U.classList.add("error");const c=document.createElement("p");c.textContent=`${f}`.replace(/.*Error: /,""),U.appendChild(c);return}console.log(`Calculated in ${h}ms.`),console.log("<AST>",r.tree.toJSON()),console.log(`${r.tree}`),I(r.tokens,r.value)}function I(t,r){if(U.innerHTML="",t.reduce((c,m)=>c+m.symbol.length,0)>v){const c=document.createElement("p");c.textContent="Expression",U.appendChild(c)}else for(const c of t){const m=document.createElement("p");m.textContent=c.symbol,m.className=n.TokenTypes[c.type],U.appendChild(m)}const h=document.createElement("p");h.textContent=" = ",U.appendChild(h);const f=document.createElement("p");f.textContent=`${r}`,U.appendChild(f)}
